name = "outside-time"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[build]
command = "npm --prefix ../web-app ci && npm --prefix ../web-app run build"

[assets]
directory = "../web-app/dist"
binding = "ASSETS"
not_found_handling = "single-page-application"

[[d1_databases]]
binding = "DB"
database_name = "outside-time-db"
database_id = "97acbf05-6366-400a-ad79-19559961c1fc"

# Rate limiting: writes (POST) — 100 requests per 60s per public key per location
[[unsafe.bindings]]
name = "WRITE_LIMITER"
type = "ratelimit"
namespace_id = "1001"
simple = { limit = 100, period = 60 }

# Rate limiting: reads (GET/HEAD) — 600 requests per 60s per public key per location
[[unsafe.bindings]]
name = "READ_LIMITER"
type = "ratelimit"
namespace_id = "1002"
simple = { limit = 600, period = 60 }

# Rate limiting: per-IP — 300 requests per 60s across all endpoints per location
[[unsafe.bindings]]
name = "IP_LIMITER"
type = "ratelimit"
namespace_id = "1003"
simple = { limit = 300, period = 60 }
